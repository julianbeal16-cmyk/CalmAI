<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmAI - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icons/6.6.6/css/flag-icons.min.css">
    <style>
        :root {
            --primary-color: #5d8aa8;
            --secondary-color: #a8c6db;
            --accent-color: #ffb347;
            --light-color: #f5f9fc;
            --dark-color: #2c3e50;
            --success-color: #7bcfa9;
            --error-color: #e74c3c;
            --warning-color: #ffb347;
            --info-color: #5d8aa8;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f9ff;
            color: var(--dark-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        body[dir="rtl"] {
            text-align: right;
        }

        body[dir="ltr"] {
            text-align: left;
        }

        /* Header */
        .admin-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            background-color: white;
            color: var(--primary-color);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .site-title h1 {
            font-size: 1.5rem;
            margin-bottom: 0.2rem;
        }

        .site-title p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }

        /* Language Switcher */
        .language-switcher {
            display: flex;
            gap: 0.5rem;
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .lang-btn.active {
            background: white;
            color: var(--primary-color);
            border-color: white;
        }

        .flag-icon {
            font-size: 1rem;
        }

        /* Main Container */
        .admin-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .admin-sidebar {
            width: 260px;
            background-color: white;
            padding: 1.5rem 1rem;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .menu-section {
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 0.8rem;
            padding: 0 1rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .menu-btn {
            padding: 0.9rem 1rem;
            border: none;
            background-color: white;
            color: var(--dark-color);
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.95rem;
            font-weight: 500;
            transition: var(--transition);
            margin-bottom: 0.3rem;
            width: 100%;
            text-align: left;
        }

        .menu-btn:hover {
            background-color: var(--light-color);
            transform: translateX(3px);
        }

        .menu-btn.active {
            background-color: var(--secondary-color);
            color: white;
        }

        .menu-btn i {
            font-size: 1.1rem;
            width: 25px;
        }

        /* Content Area */
        .admin-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            max-height: calc(100vh - 80px);
            background-color: #f8fafc;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--secondary-color);
        }

        .section-header h2 {
            font-size: 1.8rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .section-header h2 i {
            font-size: 1.5rem;
        }

        /* Tables */
        .data-table {
            width: 100%;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
        }

        .data-table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.2rem;
            background-color: var(--light-color);
            border-bottom: 1px solid #e1e8f0;
        }

        .data-table-header h3 {
            color: var(--dark-color);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-box {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 6px;
            padding: 0.5rem 0.8rem;
            border: 1px solid #e1e8f0;
            min-width: 250px;
        }

        .search-box input {
            border: none;
            outline: none;
            padding: 0.4rem;
            width: 100%;
            background: transparent;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #f8fafc;
            padding: 0.9rem;
            text-align: left;
            font-weight: 600;
            color: var(--dark-color);
            border-bottom: 1px solid #e1e8f0;
            font-size: 0.9rem;
        }

        td {
            padding: 0.9rem;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
        }

        tr:hover {
            background-color: #f8fbff;
        }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .user-info {
            line-height: 1.4;
        }

        .user-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .user-id {
            font-size: 0.8rem;
            color: #888;
        }

        .status-badge {
            padding: 0.3rem 0.7rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-active {
            background-color: rgba(123, 207, 169, 0.15);
            color: #1e7a56;
        }

        .status-inactive {
            background-color: rgba(255, 179, 71, 0.15);
            color: #b37400;
        }

        .status-banned {
            background-color: rgba(231, 76, 60, 0.15);
            color: #c0392b;
        }

        .status-premium {
            background-color: rgba(93, 138, 168, 0.15);
            color: var(--primary-color);
        }

        .status-free {
            background-color: rgba(168, 198, 219, 0.15);
            color: #5d8aa8;
        }

        .action-buttons {
            display: flex;
            gap: 0.4rem;
        }

        .btn {
            padding: 0.5rem 0.9rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-sm {
            padding: 0.3rem 0.7rem;
            font-size: 0.8rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #4a7694;
        }

        .btn-secondary {
            background-color: var(--light-color);
            color: var(--dark-color);
            border: 1px solid #e1e8f0;
        }

        .btn-secondary:hover {
            background-color: #e8f0f7;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #69b995;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e69c3e;
        }

        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d62c1a;
        }

        /* Forms */
        .form-card {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
        }

        .form-card h3 {
            color: var(--primary-color);
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #e1e8f0;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.7rem 0.9rem;
            border: 1px solid #e1e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: var(--transition);
            background-color: #fafcff;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 138, 168, 0.15);
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-hint {
            font-size: 0.8rem;
            color: #777;
            margin-top: 0.3rem;
            line-height: 1.4;
        }

        /* Tabs */
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid #e1e8f0;
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 0.8rem 1.2rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease-out;
            min-width: 280px;
            max-width: 350px;
        }

        .toast.success {
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left: 4px solid var(--error-color);
        }

        .toast.info {
            border-left: 4px solid var(--info-color);
        }

        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }

        .toast i {
            font-size: 1.1rem;
        }

        .toast.success i {
            color: var(--success-color);
        }

        .toast.error i {
            color: var(--error-color);
        }

        .toast.info i {
            color: var(--info-color);
        }

        .toast.warning i {
            color: var(--warning-color);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            flex: 1;
            min-width: 200px;
            background-color: white;
            border-radius: 10px;
            padding: 1.2rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
        }

        .quick-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background-color: var(--light-color);
        }

        .quick-action-btn i {
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .quick-action-title {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .admin-sidebar {
                width: 240px;
            }
        }

        @media (max-width: 992px) {
            .admin-container {
                flex-direction: column;
            }
            .admin-sidebar {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                padding: 1rem;
                gap: 0.5rem;
            }
            .menu-section {
                margin-bottom: 0;
                flex: 1;
                min-width: 200px;
            }
            .menu-btn {
                padding: 0.7rem;
                font-size: 0.9rem;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            .admin-info {
                width: 100%;
                justify-content: space-between;
            }
            .data-table-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            .search-box {
                width: 100%;
                min-width: auto;
            }
            .admin-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            .tab-btn {
                padding: 0.6rem 0.9rem;
                font-size: 0.85rem;
            }
            .action-buttons {
                flex-direction: column;
                gap: 0.3rem;
            }
            .btn-sm {
                padding: 0.2rem 0.5rem;
                font-size: 0.75rem;
            }
            .quick-actions {
                flex-direction: column;
            }
            .quick-action-btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body dir="ltr">
    <!-- Header -->
    <header class="admin-header">
        <div class="logo-container">
            <div class="logo">C</div>
            <div class="site-title">
                <h1 class="site-title-en">CalmAI Admin Dashboard</h1>
                <h1 class="site-title-ar" style="display: none;">لوحة تحكم CalmAI</h1>
                <p class="site-subtitle-en">Content & User Management System</p>
                <p class="site-subtitle-ar" style="display: none;">نظام إدارة المحتوى والمستخدمين</p>
            </div>
        </div>
        <div class="admin-info">
            <div class="language-switcher">
                <button class="lang-btn active" id="english-btn">
                    <span class="flag-icon fi fi-us"></span>
                    <span class="lang-text-en">English</span>
                    <span class="lang-text-ar" style="display: none;">الإنجليزية</span>
                </button>
                <button class="lang-btn" id="arabic-btn">
                    <span class="flag-icon fi fi-ae"></span>
                    <span class="lang-text-en">Arabic</span>
                    <span class="lang-text-ar" style="display: none;">العربية</span>
                </button>
            </div>
            <div class="admin-avatar">AD</div>
            <div>
                <div class="admin-name-en">System Administrator</div>
                <div class="admin-name-ar" style="display: none;">مدير النظام</div>
                <div class="admin-role-en" style="font-size: 0.75rem; opacity: 0.8;">Full Permissions</div>
                <div class="admin-role-ar" style="font-size: 0.75rem; opacity: 0.8; display: none;">صلاحيات كاملة</div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <div class="menu-section">
                <div class="section-title section-title-en">Main</div>
                <div class="section-title section-title-ar" style="display: none;">الرئيسية</div>
                <button class="menu-btn active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="menu-text-en">Dashboard</span>
                    <span class="menu-text-ar" style="display: none;">لوحة التحكم</span>
                </button>
            </div>

            <div class="menu-section">
                <div class="section-title section-title-en">Users</div>
                <div class="section-title section-title-ar" style="display: none;">المستخدمين</div>
                <button class="menu-btn" data-section="users">
                    <i class="fas fa-users"></i>
                    <span class="menu-text-en">Manage Users</span>
                    <span class="menu-text-ar" style="display: none;">إدارة المستخدمين</span>
                </button>
                <button class="menu-btn" data-section="subscriptions">
                    <i class="fas fa-crown"></i>
                    <span class="menu-text-en">Subscriptions</span>
                    <span class="menu-text-ar" style="display: none;">الإشتراكات</span>
                </button>
            </div>

            <div class="menu-section">
                <div class="section-title section-title-en">Content Control</div>
                <div class="section-title section-title-ar" style="display: none;">التحكم بالمحتوى</div>
                <button class="menu-btn" data-section="ai-control">
                    <i class="fas fa-robot"></i>
                    <span class="menu-text-en">AI Control</span>
                    <span class="menu-text-ar" style="display: none;">التحكم بالذكاء الاصطناعي</span>
                </button>
                <button class="menu-btn" data-section="content">
                    <i class="fas fa-plus-circle"></i>
                    <span class="menu-text-en">Add Content</span>
                    <span class="menu-text-ar" style="display: none;">إضافة محتوى</span>
                </button>
            </div>

            <div class="menu-section">
                <div class="section-title section-title-en">Settings</div>
                <div class="section-title section-title-ar" style="display: none;">الإعدادات</div>
                <button class="menu-btn" data-section="payment">
                    <i class="fas fa-credit-card"></i>
                    <span class="menu-text-en">Payments</span>
                    <span class="menu-text-ar" style="display: none;">المدفوعات</span>
                </button>
                <button class="menu-btn" data-section="notifications">
                    <i class="fas fa-bell"></i>
                    <span class="menu-text-en">Notifications</span>
                    <span class="menu-text-ar" style="display: none;">الإشعارات</span>
                </button>
                <button class="menu-btn" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span class="menu-text-en">General Settings</span>
                    <span class="menu-text-ar" style="display: none;">الإعدادات العامة</span>
                </button>
            </div>

            <div class="menu-section" style="margin-top: auto">
                <button class="menu-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="menu-text-en">Logout</span>
                    <span class="menu-text-ar" style="display: none;">تسجيل الخروج</span>
                </button>
            </div>
        </nav>

        <!-- Content Area -->
        <main class="admin-content">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <div class="section-header">
                    <h2><i class="fas fa-tachometer-alt"></i> <span class="section-title-en">Main Dashboard</span>
                    <span class="section-title-ar" style="display: none;">لوحة التحكم الرئيسية</span></h2>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="quick-action-btn" id="add-user-btn">
                        <i class="fas fa-user-plus"></i>
                        <div class="quick-action-title quick-action-title-en">Add New User</div>
                        <div class="quick-action-title quick-action-title-ar" style="display: none;">إضافة مستخدم جديد</div>
                    </button>

                    <button class="quick-action-btn" id="send-notification-btn">
                        <i class="fas fa-bell"></i>
                        <div class="quick-action-title quick-action-title-en">Send Broadcast</div>
                        <div class="quick-action-title quick-action-title-ar" style="display: none;">إرسال إشعار عام</div>
                    </button>

                    <button class="quick-action-btn" id="view-reports-btn">
                        <i class="fas fa-chart-bar"></i>
                        <div class="quick-action-title quick-action-title-en">View Reports</div>
                        <div class="quick-action-title quick-action-title-ar" style="display: none;">عرض التقارير</div>
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="form-row">
                    <div class="form-group">
                        <div class="form-card">
                            <h3><i class="fas fa-users"></i> <span class="stats-title-en">Total Users</span>
                            <span class="stats-title-ar" style="display: none;">إجمالي المستخدمين</span></h3>
                            <div class="stat-number" id="total-users">0</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-card">
                            <h3><i class="fas fa-crown"></i> <span class="stats-title-en">Premium Users</span>
                            <span class="stats-title-ar" style="display: none;">المستخدمون المميزون</span></h3>
                            <div class="stat-number" id="premium-users">0</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-card">
                            <h3><i class="fas fa-robot"></i> <span class="stats-title-en">AI Conversations</span>
                            <span class="stats-title-ar" style="display: none;">محادثات الذكاء الاصطناعي</span></h3>
                            <div class="stat-number" id="ai-conversations">0</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="data-table">
                    <div class="data-table-header">
                        <h3><i class="fas fa-history"></i> <span class="table-title-en">Recent Activity</span>
                        <span class="table-title-ar" style="display: none;">آخر النشاطات</span></h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th class="activity-en">Activity</th>
                                <th class="activity-ar" style="display: none;">النشاط</th>
                                <th class="user-en">User</th>
                                <th class="user-ar" style="display: none;">المستخدم</th>
                                <th class="time-en">Time</th>
                                <th class="time-ar" style="display: none;">الوقت</th>
                            </tr>
                        </thead>
                        <tbody id="activity-table-body">
                            <!-- Will be filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Users Management Section -->
            <section id="users-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> <span class="section-title-en">Users Management</span>
                    <span class="section-title-ar" style="display: none;">إدارة المستخدمين</span></h2>
                    <button class="btn btn-primary" id="export-users-btn">
                        <i class="fas fa-download"></i>
                        <span class="btn-text-en">Export Data</span>
                        <span class="btn-text-ar" style="display: none;">تصدير البيانات</span>
                    </button>
                </div>

                <div class="admin-tabs">
                    <button class="tab-btn active" data-tab="all-users">
                        <span class="tab-text-en">All Users</span>
                        <span class="tab-text-ar" style="display: none;">جميع المستخدمين</span>
                    </button>
                    <button class="tab-btn" data-tab="banned-users">
                        <span class="tab-text-en">Banned Users</span>
                        <span class="tab-text-ar" style="display: none;">المستخدمون المحظورون</span>
                    </button>
                    <button class="tab-btn" data-tab="premium-users">
                        <span class="tab-text-en">Subscribers</span>
                        <span class="tab-text-ar" style="display: none;">المشتركون</span>
                    </button>
                </div>

                <div class="tab-content active" id="all-users-tab">
                    <div class="data-table">
                        <div class="data-table-header">
                            <h3><i class="fas fa-list"></i> <span class="table-title-en">Users List</span>
                            <span class="table-title-ar" style="display: none;">قائمة المستخدمين</span></h3>
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" class="search-input-en" placeholder="Search users...">
                                <input type="text" class="search-input-ar" placeholder="البحث عن مستخدم..." style="display: none;">
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th class="column-user-en">User</th>
                                    <th class="column-user-ar" style="display: none;">المستخدم</th>
                                    <th class="column-email-en">Email</th>
                                    <th class="column-email-ar" style="display: none;">البريد الإلكتروني</th>
                                    <th class="column-subscription-en">Subscription</th>
                                    <th class="column-subscription-ar" style="display: none;">نوع الاشتراك</th>
                                    <th class="column-status-en">Status</th>
                                    <th class="column-status-ar" style="display: none;">الحالة</th>
                                    <th class="column-actions-en">Actions</th>
                                    <th class="column-actions-ar" style="display: none;">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Will be filled by JavaScript -->
                            </tbody>
                        </table>
                        <div style="padding: 1rem; text-align: center;">
                            <button class="btn btn-secondary" id="load-more-users">
                                <i class="fas fa-plus"></i>
                                <span class="btn-text-en">Load More</span>
                                <span class="btn-text-ar" style="display: none;">تحميل المزيد</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Subscriptions Section -->
            <section id="subscriptions-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-crown"></i> <span class="section-title-en">Subscriptions Management</span>
                    <span class="section-title-ar" style="display: none;">إدارة الاشتراكات</span></h2>
                </div>
                
                <div class="form-card">
                    <h3><i class="fas fa-sliders-h"></i> <span class="form-title-en">Subscription Settings</span>
                    <span class="form-title-ar" style="display: none;">إعدادات الاشتراك</span></h3>
                    
                    <div class="form-group">
                        <label class="form-label-en">Free Messages Before Payment</label>
                        <label class="form-label-ar" style="display: none;">عدد الرسائل المجانية قبل الدفع</label>
                        <input type="number" class="form-control" id="free-messages-limit" value="20" min="1" max="100">
                        <div class="form-hint form-hint-en">Number of messages free users can send</div>
                        <div class="form-hint form-hint-ar" style="display: none;">عدد الرسائل التي يمكن للمستخدمين المجانيين إرسالها</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label-en">Ads Required for Upgrade</label>
                        <label class="form-label-ar" style="display: none;">الإعلانات المطلوبة للترقية</label>
                        <input type="number" class="form-control" id="ads-required" value="50" min="1" max="500">
                        <div class="form-hint form-hint-en">Ads required to upgrade to higher plan</div>
                        <div class="form-hint form-hint-ar" style="display: none;">الإعلانات المطلوبة للترقية للخطة الأعلى</div>
                    </div>

                    <button class="btn btn-success" id="save-subscription-settings">
                        <i class="fas fa-save"></i>
                        <span class="btn-text-en">Save Changes</span>
                        <span class="btn-text-ar" style="display: none;">حفظ التغييرات</span>
                    </button>
                </div>
            </section>

            <!-- AI Control Section -->
            <section id="ai-control-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-robot"></i> <span class="section-title-en">AI Control</span>
                    <span class="section-title-ar" style="display: none;">تحكم الذكاء الاصطناعي</span></h2>
                </div>

                <div class="form-card">
                    <h3><i class="fas fa-ban"></i> <span class="form-title-en">Banned Phrases</span>
                    <span class="form-title-ar" style="display: none;">العبارات المحظورة</span></h3>

                    <div class="form-group">
                        <label class="form-label-en">Add New Banned Phrase</label>
                        <label class="form-label-ar" style="display: none;">إضافة عبارة محظورة جديدة</label>
                        <div class="form-row">
                            <input type="text" class="form-control phrase-input-en" placeholder="Enter banned phrase...">
                            <input type="text" class="form-control phrase-input-ar" placeholder="أدخل العبارة المحظورة..." style="display: none;">
                            <button class="btn btn-primary" id="add-banned-phrase">
                                <i class="fas fa-plus"></i>
                                <span class="btn-text-en">Add</span>
                                <span class="btn-text-ar" style="display: none;">إضافة</span>
                            </button>
                        </div>
                        <div class="form-hint form-hint-en">Messages containing this phrase will be blocked</div>
                        <div class="form-hint form-hint-ar" style="display: none;">سيتم حظر أي رسالة تحتوي على هذه العبارات</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label-en">Banned Phrases List</label>
                        <label class="form-label-ar" style="display: none;">قائمة العبارات المحظورة</label>
                        <div id="banned-phrases-list" style="background-color: #f8fafc; border-radius: 8px; padding: 0.8rem; max-height: 300px; overflow-y: auto; border: 1px solid #e1e8f0;">
                            <!-- Will be filled by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Add Content Section -->
            <section id="content-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-plus-circle"></i> <span class="section-title-en">Add New Content</span>
                    <span class="section-title-ar" style="display: none;">إضافة محتوى جديد</span></h2>
                </div>

                <div class="admin-tabs">
                    <button class="tab-btn active" data-tab="add-music">
                        <i class="fas fa-music"></i>
                        <span class="tab-text-en">Add Music</span>
                        <span class="tab-text-ar" style="display: none;">إضافة موسيقى</span>
                    </button>
                    <button class="tab-btn" data-tab="add-exercise">
                        <i class="fas fa-spa"></i>
                        <span class="tab-text-en">Add Exercise</span>
                        <span class="tab-text-ar" style="display: none;">إضافة تمرين</span>
                    </button>
                    <button class="tab-btn" data-tab="add-game">
                        <i class="fas fa-gamepad"></i>
                        <span class="tab-text-en">Add Game</span>
                        <span class="tab-text-ar" style="display: none;">إضافة لعبة</span>
                    </button>
                </div>

                <!-- Add Music Tab -->
                <div class="tab-content active" id="add-music-tab">
                    <div class="form-card">
                        <h3><i class="fas fa-music"></i> <span class="form-title-en">Add New Music</span>
                        <span class="form-title-ar" style="display: none;">إضافة موسيقى جديدة</span></h3>

                        <div class="form-group">
                            <label class="form-label-en">Music Name</label>
                            <label class="form-label-ar" style="display: none;">اسم الموسيقى</label>
                            <input type="text" class="form-control music-name-en" placeholder="Enter music name">
                            <input type="text" class="form-control music-name-ar" placeholder="أدخل اسم الموسيقى" style="display: none;">
                        </div>

                        <div class="form-group">
                            <label class="form-label-en">Audio File URL</label>
                            <label class="form-label-ar" style="display: none;">رابط الملف الصوتي</label>
                            <input type="url" class="form-control" id="music-url" placeholder="https://example.com/music.mp3">
                        </div>

                        <div class="form-group">
                            <label class="form-label-en">Category</label>
                            <label class="form-label-ar" style="display: none;">التصنيف</label>
                            <div class="category-select-container">
                                <select class="form-control category-select-en" id="music-category">
                                    <option value="relaxation">Relaxation</option>
                                    <option value="meditation">Meditation</option>
                                    <option value="sleep">Sleep</option>
                                    <option value="focus">Focus</option>
                                </select>
                                <select class="form-control category-select-ar" id="music-category-ar" style="display: none;">
                                    <option value="relaxation">استرخاء</option>
                                    <option value="meditation">تأمل</option>
                                    <option value="sleep">نوم</option>
                                    <option value="focus">تركيز</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label-en">Duration (minutes)</label>
                            <label class="form-label-ar" style="display: none;">المدة (دقائق)</label>
                            <input type="number" class="form-control" id="music-duration" placeholder="30" min="1" max="180">
                        </div>

                        <button class="btn btn-success" id="add-music-btn">
                            <i class="fas fa-plus"></i>
                            <span class="btn-text-en">Add Music</span>
                            <span class="btn-text-ar" style="display: none;">إضافة الموسيقى</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Payment Settings Section -->
            <section id="payment-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-credit-card"></i> <span class="section-title-en">Payment Settings</span>
                    <span class="section-title-ar" style="display: none;">إعدادات المدفوعات</span></h2>
                </div>

                <div class="form-card">
                    <h3><i class="fas fa-cog"></i> <span class="form-title-en">Payment Settings</span>
                    <span class="form-title-ar" style="display: none;">إعدادات الدفع</span></h3>

                    <div class="form-group">
                        <label class="form-label-en">Payment Address (PayPal)</label>
                        <label class="form-label-ar" style="display: none;">عنوان الدفع (PayPal)</label>
                        <input type="text" class="form-control" id="paypal-email" value="payments@calmai.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label-en">Payment Key (Stripe)</label>
                        <label class="form-label-ar" style="display: none;">مفتاح الدفع (Stripe)</label>
                        <input type="text" class="form-control" id="stripe-key" value="pk_live_51Hx...">
                    </div>

                    <div class="form-group">
                        <label class="form-label-en">Default Currency</label>
                        <label class="form-label-ar" style="display: none;">العملة الافتراضية</label>
                        <div class="currency-select-container">
                            <select class="form-control currency-select-en" id="default-currency">
                                <option value="USD">US Dollar (USD)</option>
                                <option value="EUR">Euro (EUR)</option>
                                <option value="SAR">Saudi Riyal (SAR)</option>
                                <option value="AED">UAE Dirham (AED)</option>
                            </select>
                            <select class="form-control currency-select-ar" id="default-currency-ar" style="display: none;">
                                <option value="USD">دولار أمريكي (USD)</option>
                                <option value="EUR">يورو (EUR)</option>
                                <option value="SAR">ريال سعودي (SAR)</option>
                                <option value="AED">درهم إماراتي (AED)</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-success" id="save-payment-settings">
                        <i class="fas fa-save"></i>
                        <span class="btn-text-en">Save Payment Settings</span>
                        <span class="btn-text-ar" style="display: none;">حفظ إعدادات الدفع</span>
                    </button>
                </div>
            </section>

            <!-- Notifications Section -->
            <section id="notifications-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-bell"></i> <span class="section-title-en">Send Notifications</span>
                    <span class="section-title-ar" style="display: none;">إرسال الإشعارات</span></h2>
                </div>

                <div class="form-card">
                    <h3><i class="fas fa-paper-plane"></i> <span class="form-title-en">Create New Notification</span>
                    <span class="form-title-ar" style="display: none;">إنشاء إشعار جديد</span></h3>

                    <div class="form-group">
                        <label class="form-label-en">Notification Title</label>
                        <label class="form-label-ar" style="display: none;">عنوان الإشعار</label>
                        <input type="text" class="form-control notification-title-en" placeholder="Enter notification title">
                        <input type="text" class="form-control notification-title-ar" placeholder="أدخل عنوان الإشعار" style="display: none;">
                    </div>

                    <div class="form-group">
                        <label class="form-label-en">Notification Text</label>
                        <label class="form-label-ar" style="display: none;">نص الإشعار</label>
                        <textarea class="form-control notification-text-en" rows="4" placeholder="Enter notification text"></textarea>
                        <textarea class="form-control notification-text-ar" rows="4" placeholder="أدخل نص الإشعار" style="display: none;"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label-en">Target Audience</label>
                        <label class="form-label-ar" style="display: none;">الفئة المستهدفة</label>
                        <div class="target-select-container">
                            <select class="form-control target-select-en" id="notification-target">
                                <option value="all">All Users</option>
                                <option value="premium">Paid Subscribers Only</option>
                                <option value="free">Free Users Only</option>
                                <option value="new">New Users</option>
                            </select>
                            <select class="form-control target-select-ar" id="notification-target-ar" style="display: none;">
                                <option value="all">جميع المستخدمين</option>
                                <option value="premium">المشتركون المدفوعون فقط</option>
                                <option value="free">المجانيون فقط</option>
                                <option value="new">المستخدمون الجدد</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-success" id="send-notification-btn-form">
                        <i class="fas fa-paper-plane"></i>
                        <span class="btn-text-en">Send Notification</span>
                        <span class="btn-text-ar" style="display: none;">إرسال الإشعار</span>
                    </button>
                </div>
            </section>

            <!-- General Settings Section -->
            <section id="settings-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-cog"></i> <span class="section-title-en">General Settings</span>
                    <span class="section-title-ar" style="display: none;">الإعدادات العامة</span></h2>
                </div>

                <div class="form-card">
                    <h3><i class="fas fa-sliders-h"></i> <span class="form-title-en">System Settings</span>
                    <span class="form-title-ar" style="display: none;">إعدادات النظام</span></h3>

                    <div class="form-group">
                        <label class="form-label-en">App Name</label>
                        <label class="form-label-ar" style="display: none;">اسم التطبيق</label>
                        <input type="text" class="form-control" id="app-name" value="CalmAI">
                    </div>

                    <div class="form-group">
                        <label class="form-label-en">Support Email</label>
                        <label class="form-label-ar" style="display: none;">البريد الإلكتروني للدعم</label>
                        <input type="email" class="form-control" id="support-email" value="support@calmai.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label-en">Default Language</label>
                        <label class="form-label-ar" style="display: none;">اللغة الافتراضية</label>
                        <div class="default-lang-select-container">
                            <select class="form-control default-lang-select-en" id="default-language">
                                <option value="en">English</option>
                                <option value="ar">Arabic</option>
                            </select>
                            <select class="form-control default-lang-select-ar" id="default-language-ar" style="display: none;">
                                <option value="en">الإنجليزية</option>
                                <option value="ar">العربية</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-success" id="save-system-settings">
                        <i class="fas fa-save"></i>
                        <span class="btn-text-en">Save Settings</span>
                        <span class="btn-text-ar" style="display: none;">حفظ الإعدادات</span>
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Current language
        let currentLang = 'en';
        let adminToken = '';
        let isAuthenticated = false;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if admin is logged in
            checkAdminAuth();

            // Initialize language
            initializeLanguage('en');

            // Setup language switcher
            document.getElementById('arabic-btn').addEventListener('click', function() {
                switchLanguage('ar');
            });

            document.getElementById('english-btn').addEventListener('click', function() {
                switchLanguage('en');
            });

            // Setup sidebar menu
            document.querySelectorAll('.menu-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('.menu-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    // Add active class to clicked button
                    this.classList.add('active');

                    // Hide all sections
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });

                    // Show selected section
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(`${sectionId}-section`).classList.add('active');

                    // Load data for the section if needed
                    loadSectionData(sectionId);
                });
            });

            // Setup tabs
            document.querySelectorAll('.tab-btn').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');

                    // Remove active class from all tabs
                    document.querySelectorAll('.tab-btn').forEach(t => {
                        t.classList.remove('active');
                    });

                    // Add active class to clicked tab
                    this.classList.add('active');

                    // Hide all tab contents
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });

                    // Show selected tab content
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });

            // Setup action buttons
            setupActionButtons();

            // Setup logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                logoutAdmin();
            });

            // Load initial data
            loadSectionData('dashboard');
        });

        // Check admin authentication
        async function checkAdminAuth() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                // Redirect to login if no token
                window.location.href = '/admin/login.html';
                return;
            }

            try {
                const response = await fetch('/api/admin/verify-token', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    adminToken = token;
                    isAuthenticated = true;
                    loadAdminData();
                } else {
                    localStorage.removeItem('adminToken');
                    window.location.href = '/admin/login.html';
                }
            } catch (error) {
                console.error('Auth check error:', error);
                localStorage.removeItem('adminToken');
                window.location.href = '/admin/login.html';
            }
        }

        // Load admin data
        async function loadAdminData() {
            try {
                const response = await fetch('/api/admin/profile', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const adminData = await response.json();
                    updateAdminUI(adminData);
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        // Update admin UI with data
        function updateAdminUI(adminData) {
            const adminNameEl = document.querySelector('.admin-name-en');
            const adminNameArEl = document.querySelector('.admin-name-ar');
            
            if (adminNameEl && adminData.name) {
                adminNameEl.textContent = adminData.name;
                adminNameArEl.textContent = adminData.name;
            }
        }

        // Initialize language
        function initializeLanguage(lang) {
            currentLang = lang;
            updateLanguageButtons(lang);
            updateAllText(lang);
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = lang;
        }

        // Switch language
        function switchLanguage(lang) {
            currentLang = lang;
            updateLanguageButtons(lang);
            updateAllText(lang);
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = lang;

            // Update data tables with new language
            updateDataTables();
        }

        // Update language buttons
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            if (lang === 'en') {
                document.getElementById('english-btn').classList.add('active');
            } else {
                document.getElementById('arabic-btn').classList.add('active');
            }
        }

        // Update all text in the page
        function updateAllText(lang) {
            // List of all language-specific classes
            const langElements = [
                'site-title', 'site-subtitle', 'lang-text', 'section-title',
                'menu-text', 'table-title', 'btn-text', 'form-title',
                'form-label', 'form-hint', 'tab-text', 'admin-name',
                'admin-role', 'activity', 'user', 'time', 'quick-action-title',
                'column-user', 'column-email', 'column-subscription', 'column-status',
                'column-actions', 'stats-title'
            ];

            // Update all standard language elements
            langElements.forEach(className => {
                // Hide both languages
                document.querySelectorAll(`.${className}-en, .${className}-ar`).forEach(el => {
                    el.style.display = 'none';
                });

                // Show current language
                document.querySelectorAll(`.${className}-${lang}`).forEach(el => {
                    el.style.display = el.tagName === 'SPAN' || el.tagName === 'DIV' ? 'inline' : 'block';
                });
            });

            // Update all select elements
            updateAllSelectElements(lang);

            // Update all input placeholders
            updateAllInputPlaceholders(lang);
        }

        // Update all select elements
        function updateAllSelectElements(lang) {
            const selects = [
                'category-select', 'currency-select', 'target-select',
                'default-lang-select', 'sensitivity-select'
            ];

            selects.forEach(className => {
                document.querySelectorAll(`.${className}-en, .${className}-ar`).forEach(el => {
                    el.style.display = 'none';
                });

                document.querySelectorAll(`.${className}-${lang}`).forEach(el => {
                    el.style.display = 'block';
                });
            });
        }

        // Update all input placeholders
        function updateAllInputPlaceholders(lang) {
            const inputs = [
                'search-input', 'phrase-input', 'notification-title',
                'notification-text', 'music-name'
            ];

            inputs.forEach(className => {
                document.querySelectorAll(`.${className}-en, .${className}-ar`).forEach(el => {
                    el.style.display = 'none';
                });

                document.querySelectorAll(`.${className}-${lang}`).forEach(el => {
                    el.style.display = 'block';
                });
            });
        }

        // Load data for a section
        async function loadSectionData(sectionId) {
            if (!isAuthenticated) return;

            switch(sectionId) {
                case 'dashboard':
                    await loadDashboardStats();
                    await loadRecentActivity();
                    break;
                case 'users':
                    await loadUsersTable();
                    break;
                case 'ai-control':
                    await loadBannedPhrases();
                    break;
                case 'subscriptions':
                    await loadSubscriptionSettings();
                    break;
            }
        }

        // Setup action buttons
        function setupActionButtons() {
            // Add banned phrase button
            document.getElementById('add-banned-phrase').addEventListener('click', async function() {
                const input = currentLang === 'ar' ? 
                    document.querySelector('.phrase-input-ar') :
                    document.querySelector('.phrase-input-en');
                const phrase = input.value.trim();

                if (phrase === '') {
                    showToast(
                        currentLang === 'ar' ? 'الرجاء إدخال عبارة' : 'Please enter a phrase',
                        'warning'
                    );
                    return;
                }

                try {
                    const response = await fetch('/api/admin/banned-phrases', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ phrase, language: 'both' })
                    });

                    if (response.ok) {
                        showToast(
                            currentLang === 'ar' ? 'تم إضافة العبارة المحظورة' : 'Banned phrase added',
                            'success'
                        );
                        input.value = '';
                        loadBannedPhrases();
                    } else {
                        throw new Error('Failed to add phrase');
                    }
                } catch (error) {
                    console.error('Error adding banned phrase:', error);
                    showToast(
                        currentLang === 'ar' ? 'فشل إضافة العبارة' : 'Failed to add phrase',
                        'error'
                    );
                }
            });

            // Save subscription settings
            document.getElementById('save-subscription-settings').addEventListener('click', async function() {
                const freeMessages = document.getElementById('free-messages-limit').value;
                const adsRequired = document.getElementById('ads-required').value;

                try {
                    const response = await fetch('/api/admin/subscription-settings', {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            free_messages_limit: freeMessages,
                            ads_required: adsRequired
                        })
                    });

                    if (response.ok) {
                        showToast(
                            currentLang === 'ar' ? 'تم حفظ الإعدادات' : 'Settings saved',
                            'success'
                        );
                    } else {
                        throw new Error('Failed to save settings');
                    }
                } catch (error) {
                    console.error('Error saving settings:', error);
                    showToast(
                        currentLang === 'ar' ? 'فشل حفظ الإعدادات' : 'Failed to save settings',
                        'error'
                    );
                }
            });

            // Send notification
            document.getElementById('send-notification-btn-form').addEventListener('click', async function() {
                const title = currentLang === 'ar' ?
                    document.querySelector('.notification-title-ar').value :
                    document.querySelector('.notification-title-en').value;
                const text = currentLang === 'ar' ?
                    document.querySelector('.notification-text-ar').value :
                    document.querySelector('.notification-text-en').value;
                const target = document.getElementById('notification-target').value;

                if (!title || !text) {
                    showToast(
                        currentLang === 'ar' ? 'الرجاء ملء جميع الحقول' : 'Please fill all fields',
                        'warning'
                    );
                    return;
                }

                try {
                    const response = await fetch('/api/admin/send-notification', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            title, 
                            message: text, 
                            target,
                            type: 'info'
                        })
                    });

                    if (response.ok) {
                        showToast(
                            currentLang === 'ar' ? 'تم إرسال الإشعار' : 'Notification sent',
                            'success'
                        );
                        // Clear form
                        document.querySelector('.notification-title-en').value = '';
                        document.querySelector('.notification-title-ar').value = '';
                        document.querySelector('.notification-text-en').value = '';
                        document.querySelector('.notification-text-ar').value = '';
                    } else {
                        throw new Error('Failed to send notification');
                    }
                } catch (error) {
                    console.error('Error sending notification:', error);
                    showToast(
                        currentLang === 'ar' ? 'فشل إرسال الإشعار' : 'Failed to send notification',
                        'error'
                    );
                }
            });
        }

        // Load dashboard stats
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/admin/stats', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    updateDashboardStats(stats);
                }
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        // Update dashboard stats
        function updateDashboardStats(stats) {
            if (stats.users) {
                document.getElementById('total-users').textContent = stats.users.total || 0;
                document.getElementById('premium-users').textContent = stats.users.premium || 0;
            }
            // You can add more stats updates here
        }

        // Load recent activity
        async function loadRecentActivity() {
            try {
                const response = await fetch('/api/admin/activity', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const activities = await response.json();
                    updateActivityTable(activities);
                }
            } catch (error) {
                console.error('Error loading activity:', error);
            }
        }

        // Update activity table
        function updateActivityTable(activities) {
            const tableBody = document.getElementById('activity-table-body');
            if (!tableBody) return;

            tableBody.innerHTML = '';

            if (!activities || activities.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="3" style="text-align: center; color: #666; padding: 2rem;">
                        ${currentLang === 'ar' ? 'لا توجد أنشطة حديثة' : 'No recent activities'}
                    </td>
                `;
                tableBody.appendChild(row);
                return;
            }

            activities.forEach(activity => {
                const row = document.createElement('tr');
                
                let activityText = activity.event_type || 'Unknown';
                if (currentLang === 'ar') {
                    // Translate activity types to Arabic
                    const translations = {
                        'user_signup': 'تسجيل مستخدم جديد',
                        'login_success': 'تسجيل دخول',
                        'subscription_created': 'إنشاء اشتراك',
                        'content_added': 'إضافة محتوى'
                    };
                    activityText = translations[activity.event_type] || activityText;
                }

                const time = new Date(activity.timestamp).toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                row.innerHTML = `
                    <td>${activityText}</td>
                    <td>${activity.user_id ? `User ${activity.user_id.substring(0, 8)}...` : 'System'}</td>
                    <td>${time}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Load users table
        async function loadUsersTable() {
            try {
                const response = await fetch('/api/admin/users', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const users = await response.json();
                    updateUsersTable(users);
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Update users table
        function updateUsersTable(users) {
            const tableBody = document.getElementById('users-table-body');
            if (!tableBody) return;

            tableBody.innerHTML = '';

            if (!users || users.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="text-align: center; color: #666; padding: 2rem;">
                        ${currentLang === 'ar' ? 'لا يوجد مستخدمين' : 'No users found'}
                    </td>
                `;
                tableBody.appendChild(row);
                return;
            }

            users.forEach(user => {
                const row = document.createElement('tr');
                
                const statusClass = user.is_banned ? 'status-banned' : 
                                  user.is_active ? 'status-active' : 'status-inactive';
                
                const statusText = currentLang === 'ar' ? 
                    (user.is_banned ? 'محظور' : user.is_active ? 'نشط' : 'غير نشط') :
                    (user.is_banned ? 'Banned' : user.is_active ? 'Active' : 'Inactive');

                const subscriptionText = currentLang === 'ar' ?
                    (user.subscription_type === 'premium' ? 'مميز' : 
                     user.subscription_type === 'pro' ? 'احترافي' : 'مجاني') :
                    user.subscription_type;

                row.innerHTML = `
                    <td>
                        <div class="user-cell">
                            <div class="user-avatar">${user.first_name ? user.first_name[0] : 'U'}</div>
                            <div class="user-info">
                                <div class="user-name">${user.first_name || ''} ${user.last_name || ''}</div>
                                <div class="user-id">${user.user_id || user.id.substring(0, 8)}...</div>
                            </div>
                        </div>
                    </td>
                    <td>${user.email || 'No email'}</td>
                    <td><span class="status-badge ${user.subscription_type === 'premium' ? 'status-premium' : 'status-free'}">${subscriptionText}</span></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="viewUser('${user.id}')">
                                <i class="fas fa-eye"></i>
                                <span class="btn-text-en">View</span>
                                <span class="btn-text-ar" style="display: none;">عرض</span>
                            </button>
                            ${!user.is_banned ? `
                            <button class="btn btn-danger btn-sm" onclick="banUser('${user.id}')">
                                <i class="fas fa-ban"></i>
                                <span class="btn-text-en">Ban</span>
                                <span class="btn-text-ar" style="display: none;">حظر</span>
                            </button>
                            ` : `
                            <button class="btn btn-success btn-sm" onclick="unbanUser('${user.id}')">
                                <i class="fas fa-check"></i>
                                <span class="btn-text-en">Unban</span>
                                <span class="btn-text-ar" style="display: none;">إلغاء الحظر</span>
                            </button>
                            `}
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Load banned phrases
        async function loadBannedPhrases() {
            try {
                const response = await fetch('/api/admin/banned-phrases', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const phrases = await response.json();
                    updateBannedPhrasesList(phrases);
                }
            } catch (error) {
                console.error('Error loading banned phrases:', error);
            }
        }

        // Update banned phrases list
        function updateBannedPhrasesList(phrases) {
            const phrasesList = document.getElementById('banned-phrases-list');
            if (!phrasesList) return;

            phrasesList.innerHTML = '';

            if (!phrases || phrases.length === 0) {
                phrasesList.innerHTML = currentLang === 'ar' ? 
                    '<div style="text-align: center; color: #666; padding: 2rem;">لا توجد عبارات محظورة</div>' :
                    '<div style="text-align: center; color: #666; padding: 2rem;">No banned phrases</div>';
                return;
            }

            phrases.forEach((phrase, index) => {
                const phraseItem = document.createElement('div');
                phraseItem.className = 'phrase-item';
                phraseItem.style.display = 'flex';
                phraseItem.style.justifyContent = 'space-between';
                phraseItem.style.alignItems = 'center';
                phraseItem.style.padding = '0.7rem';
                phraseItem.style.borderBottom = '1px solid #e1e8f0';
                phraseItem.style.backgroundColor = index % 2 === 0 ? 'white' : '#f8fafc';
                
                phraseItem.innerHTML = `
                    <div>${phrase.phrase}</div>
                    <button class="btn btn-danger btn-sm" onclick="deleteBannedPhrase('${phrase.id}')">
                        <i class="fas fa-trash"></i>
                        <span class="btn-text-en">Delete</span>
                        <span class="btn-text-ar" style="display: none;">حذف</span>
                    </button>
                `;

                phrasesList.appendChild(phraseItem);
            });
        }

        // Load subscription settings
        async function loadSubscriptionSettings() {
            try {
                const response = await fetch('/api/admin/subscription-settings', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const settings = await response.json();
                    document.getElementById('free-messages-limit').value = settings.free_messages_limit || 20;
                    document.getElementById('ads-required').value = settings.ads_required || 50;
                }
            } catch (error) {
                console.error('Error loading subscription settings:', error);
            }
        }

        // Update data tables with current language
        function updateDataTables() {
            // Reload tables to update text
            loadUsersTable();
            loadBannedPhrases();
            loadActivityTable();
        }

        // User actions
        async function viewUser(userId) {
            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const user = await response.json();
                    // Show user details modal or navigate to user page
                    showToast(
                        currentLang === 'ar' ? `عرض مستخدم: ${user.email}` : `Viewing user: ${user.email}`,
                        'info'
                    );
                }
            } catch (error) {
                console.error('Error viewing user:', error);
            }
        }

        async function banUser(userId) {
            if (!confirm(currentLang === 'ar' ? 'هل أنت متأكد من حظر هذا المستخدم؟' : 'Are you sure you want to ban this user?')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/ban-user/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason: 'Admin decision' })
                });

                if (response.ok) {
                    showToast(
                        currentLang === 'ar' ? 'تم حظر المستخدم' : 'User banned successfully',
                        'success'
                    );
                    loadUsersTable();
                }
            } catch (error) {
                console.error('Error banning user:', error);
                showToast(
                    currentLang === 'ar' ? 'فشل حظر المستخدم' : 'Failed to ban user',
                    'error'
                );
            }
        }

        async function unbanUser(userId) {
            try {
                const response = await fetch(`/api/admin/unban-user/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    showToast(
                        currentLang === 'ar' ? 'تم إلغاء حظر المستخدم' : 'User unbanned successfully',
                        'success'
                    );
                    loadUsersTable();
                }
            } catch (error) {
                console.error('Error unbanning user:', error);
                showToast(
                    currentLang === 'ar' ? 'فشل إلغاء حظر المستخدم' : 'Failed to unban user',
                    'error'
                );
            }
        }

        async function deleteBannedPhrase(phraseId) {
            if (!confirm(currentLang === 'ar' ? 'هل أنت متأكد من حذف هذه العبارة؟' : 'Are you sure you want to delete this phrase?')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/banned-phrases/${phraseId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    showToast(
                        currentLang === 'ar' ? 'تم حذف العبارة المحظورة' : 'Banned phrase deleted',
                        'success'
                    );
                    loadBannedPhrases();
                }
            } catch (error) {
                console.error('Error deleting banned phrase:', error);
                showToast(
                    currentLang === 'ar' ? 'فشل حذف العبارة' : 'Failed to delete phrase',
                    'error'
                );
            }
        }

        // Logout admin
        function logoutAdmin() {
            localStorage.removeItem('adminToken');
            showToast(
                currentLang === 'ar' ? 'تم تسجيل الخروج بنجاح' : 'Logged out successfully',
                'success'
            );
            setTimeout(() => {
                window.location.href = '/admin/login.html';
            }, 1000);
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) return;

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.setAttribute('aria-live', 'polite');

            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';

            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <div class="toast-content">${message}</div>
                <button class="toast-close" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            `;

            toastContainer.appendChild(toast);

            // Setup close button
            const closeBtn = toast.querySelector('.toast-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                });
            }

            // Remove toast after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
        }

        // Make functions available globally
        window.viewUser = viewUser;
        window.banUser = banUser;
        window.unbanUser = unbanUser;
        window.deleteBannedPhrase = deleteBannedPhrase;
    </script>
</body>
</html>
