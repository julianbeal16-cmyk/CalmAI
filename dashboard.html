<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmAI - AI Mental Health Support</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icons/6.6.6/css/flag-icons.min.css">
    <style>
        :root {
            --primary-color: #5d8aa8;
            --secondary-color: #a8c6db;
            --accent-color: #ffb347;
            --light-color: #f5f9fc;
            --dark-color: #2c3e50;
            --success-color: #7bcfa9;
            --error-color: #e74c3c;
            --warning-color: #ffb347;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f9ff;
            color: var(--dark-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        body[dir="rtl"] {
            text-align: right;
        }

        body[dir="ltr"] {
            text-align: left;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.2rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            background-color: white;
            color: var(--primary-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .site-title h1 {
            font-size: 1.8rem;
            margin-bottom: 0.2rem;
        }

        .site-title p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* User Info */
        .user-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }

        .user-details {
            line-height: 1.4;
        }

        .user-name {
            font-weight: 600;
        }

        .user-subscription {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Language Switcher */
        .language-switcher {
            display: flex;
            gap: 0.5rem;
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .lang-btn.active {
            background: white;
            color: var(--primary-color);
            border-color: white;
        }

        .flag-icon {
            font-size: 1rem;
        }

        /* Main Container */
        .container {
            display: flex;
            min-height: calc(100vh - 90px);
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: white;
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .menu-btn {
            padding: 1rem;
            border: none;
            background-color: white;
            color: var(--dark-color);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            margin-bottom: 0.5rem;
            text-align: left;
        }

        .menu-btn:hover {
            background-color: var(--light-color);
            transform: translateX(5px);
        }

        .menu-btn.active {
            background-color: var(--secondary-color);
            color: white;
        }

        .menu-btn i {
            font-size: 1.2rem;
            width: 25px;
        }

        /* Quick Stats */
        .quick-stats {
            margin-top: auto;
            padding: 1rem;
            background-color: var(--light-color);
            border-radius: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .stat-value {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            max-height: calc(100vh - 90px);
            position: relative;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Section */
        .welcome-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .welcome-text h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .welcome-text p {
            opacity: 0.9;
            max-width: 600px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .stat-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .stat-change {
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--error-color);
        }

        /* Quick Actions */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .action-card {
            background-color: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .action-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .action-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .action-desc {
            font-size: 0.9rem;
            color: #666;
        }

        /* Chat Section */
        .chat-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background-color: #f9f9f9;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .message {
            margin-bottom: 1rem;
            max-width: 80%;
            padding: 0.8rem 1rem;
            border-radius: 18px;
            line-height: 1.4;
        }

        .user-message {
            background-color: var(--secondary-color);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .ai-message {
            background-color: white;
            color: var(--dark-color);
            border: 1px solid #ddd;
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .chat-input {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 2px solid #e1e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background-color: #fafcff;
            transition: var(--transition);
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 138, 168, 0.2);
        }

        .chat-input button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .chat-input button:hover {
            background-color: #4a7694;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(93, 138, 168, 0.2);
        }

        /* Content Sections */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .content-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .content-img {
            height: 180px;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 4rem;
        }

        .content-body {
            padding: 1.5rem;
        }

        .content-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 0.8rem;
        }

        .content-desc {
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        /* Games Section */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .game-card {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .game-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .game-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .game-desc {
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* Profile Section */
        .profile-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-card {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
        }

        .profile-info h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .profile-subscription {
            display: inline-block;
            padding: 0.3rem 1rem;
            background-color: var(--light-color);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .profile-subscription.premium {
            background-color: rgba(123, 207, 169, 0.15);
            color: #1e7a56;
        }

        .profile-subscription.free {
            background-color: rgba(93, 138, 168, 0.15);
            color: var(--primary-color);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .profile-stat {
            text-align: center;
            padding: 1rem;
            background-color: var(--light-color);
            border-radius: 12px;
        }

        .profile-stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .profile-stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            min-width: 300px;
            max-width: 400px;
        }

        .toast.success {
            border-left: 4px solid var(--success-color);
        }

        .toast.info {
            border-left: 4px solid var(--primary-color);
        }

        .toast.error {
            border-left: 4px solid var(--error-color);
        }

        .toast i {
            font-size: 1.2rem;
        }

        .toast.success i {
            color: var(--success-color);
        }

        .toast.info i {
            color: var(--primary-color);
        }

        .toast.error i {
            color: var(--error-color);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 4000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                padding: 1rem;
            }
            .menu-btn {
                flex: 1;
                min-width: 150px;
                justify-content: center;
            }
            .content-area {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
            .menu-btn {
                min-width: 130px;
                font-size: 0.9rem;
            }
            .stats-grid,
            .quick-actions-grid,
            .content-grid,
            .games-grid {
                grid-template-columns: 1fr;
            }
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body dir="ltr">
    <!-- Header -->
    <header class="header">
        <div class="logo-container">
            <div class="logo">C</div>
            <div class="site-title">
                <h1 class="site-title-en">CalmAI</h1>
                <h1 class="site-title-ar" style="display: none;">CalmAI</h1>
                <p class="site-subtitle-en">AI-Powered Mental Health Support and Wellness</p>
                <p class="site-subtitle-ar" style="display: none;">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ ÙˆØ§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ø°Ù‡Ù†ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
            </div>
        </div>

        <div class="user-info">
            <div class="language-switcher">
                <button class="lang-btn active" id="english-btn">
                    <span class="flag-icon fi fi-us"></span>
                    <span class="lang-text-en">English</span>
                    <span class="lang-text-ar" style="display: none;">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</span>
                </button>
                <button class="lang-btn" id="arabic-btn">
                    <span class="flag-icon fi fi-ae"></span>
                    <span class="lang-text-en">Arabic</span>
                    <span class="lang-text-ar" style="display: none;">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                </button>
            </div>

            <div class="user-profile" id="user-profile-btn">
                <div class="user-avatar" id="user-avatar">U</div>
                <div class="user-details">
                    <div class="user-name" id="user-name">Loading...</div>
                    <div class="user-subscription" id="user-subscription">Free Plan</div>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <button class="menu-btn active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span class="menu-text-en">Dashboard</span>
                <span class="menu-text-ar" style="display: none;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
            </button>
            <button class="menu-btn" data-section="chat">
                <i class="fas fa-robot"></i>
                <span class="menu-text-en">AI Chat</span>
                <span class="menu-text-ar" style="display: none;">Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
            </button>
            <button class="menu-btn" data-section="content">
                <i class="fas fa-spa"></i>
                <span class="menu-text-en">Relaxation</span>
                <span class="menu-text-ar" style="display: none;">Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡</span>
            </button>
            <button class="menu-btn" data-section="games">
                <i class="fas fa-gamepad"></i>
                <span class="menu-text-en">Calming Games</span>
                <span class="menu-text-ar" style="display: none;">Ø£Ù„Ø¹Ø§Ø¨ Ù…Ù‡Ø¯Ø¦Ø©</span>
            </button>
            <button class="menu-btn" data-section="profile">
                <i class="fas fa-user"></i>
                <span class="menu-text-en">Profile</span>
                <span class="menu-text-ar" style="display: none;">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
            </button>

            <div class="quick-stats">
                <div class="stat-item">
                    <span class="stat-label stat-label-en">Today's Mood</span>
                    <span class="stat-label stat-label-ar" style="display: none;">Ø§Ù„Ù…Ø²Ø§Ø¬ Ø§Ù„ÙŠÙˆÙ…</span>
                    <span class="stat-value" id="today-mood">Good</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label stat-label-en">Streak</span>
                    <span class="stat-label stat-label-ar" style="display: none;">Ø§Ù„ØªÙˆØ§ØµÙ„</span>
                    <span class="stat-value" id="login-streak">0 days</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label stat-label-en">Messages Left</span>
                    <span class="stat-label stat-label-ar" style="display: none;">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</span>
                    <span class="stat-value" id="messages-left">20</span>
                </div>
            </div>
        </nav>

        <!-- Content Area -->
        <main class="content-area">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <!-- Welcome Section -->
                <div class="welcome-section">
                    <div class="welcome-text">
                        <h2 class="greeting-en">Welcome back, <span id="user-greeting-name">User</span>! ğŸ‘‹</h2>
                        <h2 class="greeting-ar" style="display: none;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒØŒ <span id="user-greeting-name-ar">Ù…Ø³ØªØ®Ø¯Ù…</span>! ğŸ‘‹</h2>
                        <p class="welcome-message-en">How are you feeling today? Remember, your mental health matters.</p>
                        <p class="welcome-message-ar" style="display: none;">ÙƒÙŠÙ ØªØ´Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…ØŸ ØªØ°ÙƒØ± Ø£Ù† ØµØ­ØªÙƒ Ø§Ù„Ù†ÙØ³ÙŠØ© Ù…Ù‡Ù…Ø©.</p>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-title stat-title-en">AI Conversations</div>
                        <div class="stat-title stat-title-ar" style="display: none;">Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
                        <div class="stat-number" id="total-conversations">0</div>
                        <div class="stat-change positive" id="conversations-change">+0 this week</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="stat-title stat-title-en">Mindfulness Minutes</div>
                        <div class="stat-title stat-title-ar" style="display: none;">Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„ÙŠÙ‚Ø¸Ø© Ø§Ù„Ø°Ù‡Ù†ÙŠØ©</div>
                        <div class="stat-number" id="mindfulness-minutes">0</div>
                        <div class="stat-change positive" id="mindfulness-change">+0 this week</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-title stat-title-en">Mood Score</div>
                        <div class="stat-title stat-title-ar" style="display: none;">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø²Ø§Ø¬</div>
                        <div class="stat-number" id="mood-score">0/10</div>
                        <div class="stat-change positive" id="mood-change">+0 this week</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-award"></i>
                        </div>
                        <div class="stat-title stat-title-en">Achievements</div>
                        <div class="stat-title stat-title-ar" style="display: none;">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</div>
                        <div class="stat-number" id="achievements-count">0</div>
                        <div class="stat-change positive" id="achievements-change">Unlocked 0 new</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <h3 class="section-subtitle-en" style="margin-bottom: 1rem;">Quick Actions</h3>
                <h3 class="section-subtitle-ar" style="margin-bottom: 1rem; display: none;">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>

                <div class="quick-actions-grid">
                    <div class="action-card" id="quick-chat-btn">
                        <div class="action-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="action-title action-title-en">Quick Chat</div>
                        <div class="action-title action-title-ar" style="display: none;">Ù…Ø­Ø§Ø¯Ø«Ø© Ø³Ø±ÙŠØ¹Ø©</div>
                        <div class="action-desc action-desc-en">Talk to our AI assistant</div>
                        <div class="action-desc action-desc-ar" style="display: none;">ØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ø³Ø§Ø¹Ø¯Ù†Ø§ Ø§Ù„Ø°ÙƒÙŠ</div>
                    </div>

                    <div class="action-card" id="breathing-exercise-btn">
                        <div class="action-icon">
                            <i class="fas fa-wind"></i>
                        </div>
                        <div class="action-title action-title-en">Breathing Exercise</div>
                        <div class="action-title action-title-ar" style="display: none;">ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙØ³</div>
                        <div class="action-desc action-desc-en">5-min relaxation session</div>
                        <div class="action-desc action-desc-ar" style="display: none;">Ø¬Ù„Ø³Ø© Ø§Ø³ØªØ±Ø®Ø§Ø¡ 5 Ø¯Ù‚Ø§Ø¦Ù‚</div>
                    </div>

                    <div class="action-card" id="mood-check-btn">
                        <div class="action-icon">
                            <i class="fas fa-smile"></i>
                        </div>
                        <div class="action-title action-title-en">Mood Check-in</div>
                        <div class="action-title action-title-ar" style="display: none;">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø²Ø§Ø¬</div>
                        <div class="action-desc action-desc-en">Track how you feel</div>
                        <div class="action-desc action-desc-ar" style="display: none;">ØªØ§Ø¨Ø¹ Ù…Ø´Ø§Ø¹Ø±Ùƒ</div>
                    </div>

                    <div class="action-card" id="journal-btn">
                        <div class="action-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="action-title action-title-en">Daily Journal</div>
                        <div class="action-title action-title-ar" style="display: none;">Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
                        <div class="action-desc action-desc-en">Write your thoughts</div>
                        <div class="action-desc action-desc-ar" style="display: none;">Ø§ÙƒØªØ¨ Ø£ÙÙƒØ§Ø±Ùƒ</div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="stat-card" style="margin-top: 2rem;">
                    <div class="stat-title stat-title-en" style="font-size: 1.1rem; margin-bottom: 1rem;">
                        <i class="fas fa-history"></i> Recent Activity
                    </div>
                    <div class="stat-title stat-title-ar" style="font-size: 1.1rem; margin-bottom: 1rem; display: none;">
                        <i class="fas fa-history"></i> Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±
                    </div>
                    <div id="recent-activity">
                        <div style="text-align: center; color: #666; padding: 2rem;">
                            Loading recent activity...
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI Chat Section -->
            <section id="chat-section" class="content-section">
                <div class="chat-container">
                    <div class="chat-header">
                        <div>
                            <h3 class="chat-title-en">CalmAI Assistant</h3>
                            <h3 class="chat-title-ar" style="display: none;">Ù…Ø³Ø§Ø¹Ø¯ CalmAI</h3>
                            <p class="chat-subtitle-en" style="font-size: 0.9rem; color: #666;">
                                Your personal mental health companion
                            </p>
                            <p class="chat-subtitle-ar" style="font-size: 0.9rem; color: #666; display: none;">
                                Ø±ÙÙŠÙ‚Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„ØµØ­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©
                            </p>
                        </div>
                        <div class="chat-stats">
                            <span class="chat-stat-en" style="font-size: 0.8rem; color: var(--success-color);">
                                <i class="fas fa-circle" style="font-size: 0.6rem;"></i>
                                Online
                            </span>
                            <span class="chat-stat-ar" style="font-size: 0.8rem; color: var(--success-color); display: none;">
                                <i class="fas fa-circle" style="font-size: 0.6rem;"></i>
                                Ù…ØªØµÙ„
                            </span>
                        </div>
                    </div>

                    <div class="chat-messages" id="chat-messages">
                        <!-- Messages will be loaded here -->
                    </div>

                    <div class="chat-input">
                        <input type="text" id="message-input" placeholder="Type your message here...">
                        <button id="send-btn">
                            <i class="fas fa-paper-plane"></i>
                            <span class="send-text-en">Send</span>
                            <span class="send-text-ar" style="display: none;">Ø¥Ø±Ø³Ø§Ù„</span>
                        </button>
                    </div>
                </div>

                <div class="privacy-notice" style="margin-top: 1rem; padding: 1rem; background: #e8f4fd; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                    <i class="fas fa-shield-alt" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                    <span class="privacy-text-en" style="font-size: 0.9rem;">
                        Your conversations are private and encrypted. No data is shared with third parties.
                    </span>
                    <span class="privacy-text-ar" style="font-size: 0.9rem; display: none;">
                        Ù…Ø­Ø§Ø¯Ø«Ø§ØªÙƒ Ø®Ø§ØµØ© ÙˆÙ…Ø´ÙØ±Ø©. Ù„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø£Ø·Ø±Ø§Ù Ø«Ø§Ù„Ø«Ø©.
                    </span>
                </div>
            </section>

            <!-- Relaxation Content Section -->
            <section id="content-section-relax" class="content-section">
                <h2 class="section-title-en" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1.5rem;">
                    <i class="fas fa-spa"></i> Relaxation & Wellness
                </h2>
                <h2 class="section-title-ar" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1.5rem; display: none;">
                    <i class="fas fa-spa"></i> Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆØ§Ù„Ø¹Ø§ÙÙŠØ©
                </h2>

                <div class="content-grid">
                    <!-- Meditation -->
                    <div class="content-card">
                        <div class="content-img">
                            <i class="fas fa-yin-yang"></i>
                        </div>
                        <div class="content-body">
                            <h3 class="content-title content-title-en">Guided Meditation</h3>
                            <h3 class="content-title content-title-ar" style="display: none;">ØªØ£Ù…Ù„ Ù…ÙˆØ¬Ù‡</h3>
                            <p class="content-desc content-desc-en">
                                Relax your mind with our guided meditation sessions designed to reduce stress and anxiety.
                            </p>
                            <p class="content-desc content-desc-ar" style="display: none;">
                                Ø§Ø³ØªØ±Ø®Ù Ø¹Ù‚Ù„Ùƒ Ù…Ø¹ Ø¬Ù„Ø³Ø§Øª Ø§Ù„ØªØ£Ù…Ù„ Ø§Ù„Ù…ÙˆØ¬Ù‡Ø© Ø§Ù„Ù…ØµÙ…Ù…Ø© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØªØ± ÙˆØ§Ù„Ù‚Ù„Ù‚.
                            </p>
                            <button class="action-btn" onclick="startMeditation()" style="width: 100%; padding: 0.8rem; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <span class="btn-text-en">Start Session</span>
                                <span class="btn-text-ar" style="display: none;">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</span>
                            </button>
                        </div>
                    </div>

                    <!-- Breathing Exercises -->
                    <div class="content-card">
                        <div class="content-img">
                            <i class="fas fa-wind"></i>
                        </div>
                        <div class="content-body">
                            <h3 class="content-title content-title-en">Breathing Exercises</h3>
                            <h3 class="content-title content-title-ar" style="display: none;">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙØ³</h3>
                            <p class="content-desc content-desc-en">
                                Learn breathing techniques to calm your nervous system and reduce anxiety instantly.
                            </p>
                            <p class="content-desc content-desc-ar" style="display: none;">
                                ØªØ¹Ù„Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªÙ†ÙØ³ Ù„ØªÙ‡Ø¯Ø¦Ø© Ø¬Ù‡Ø§Ø²Ùƒ Ø§Ù„Ø¹ØµØ¨ÙŠ ÙˆØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‚Ù„Ù‚ ÙÙˆØ±Ø§Ù‹.
                            </p>
                            <button class="action-btn" onclick="startBreathingExercise()" style="width: 100%; padding: 0.8rem; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <span class="btn-text-en">Start Exercise</span>
                                <span class="btn-text-ar" style="display: none;">Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</span>
                            </button>
                        </div>
                    </div>

                    <!-- Sleep Stories -->
                    <div class="content-card">
                        <div class="content-img">
                            <i class="fas fa-moon"></i>
                        </div>
                        <div class="content-body">
                            <h3 class="content-title content-title-en">Sleep Stories</h3>
                            <h3 class="content-title content-title-ar" style="display: none;">Ù‚ØµØµ Ø§Ù„Ù†ÙˆÙ…</h3>
                            <p class="content-desc content-desc-en">
                                Drift off to sleep with calming stories and soothing sounds for better sleep quality.
                            </p>
                            <p class="content-desc content-desc-ar" style="display: none;">
                                Ø§ØºØ±Ù‚ ÙÙŠ Ø§Ù„Ù†ÙˆÙ… Ù…Ø¹ Ù‚ØµØµ Ù…Ù‡Ø¯Ø¦Ø© ÙˆØ£ØµÙˆØ§Øª Ù…Ø³ÙƒÙ†Ø© Ù„Ù†ÙˆØ¹ÙŠØ© Ù†ÙˆÙ… Ø£ÙØ¶Ù„.
                            </p>
                            <button class="action-btn" onclick="playSleepStory()" style="width: 100%; padding: 0.8rem; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <span class="btn-text-en">Listen Now</span>
                                <span class="btn-text-ar" style="display: none;">Ø§Ø³ØªÙ…Ø¹ Ø§Ù„Ø¢Ù†</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Games Section -->
            <section id="games-section" class="content-section">
                <h2 class="section-title-en" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1.5rem;">
                    <i class="fas fa-gamepad"></i> Calming Games
                </h2>
                <h2 class="section-title-ar" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1.5rem; display: none;">
                    <i class="fas fa-gamepad"></i> Ø£Ù„Ø¹Ø§Ø¨ Ù…Ù‡Ø¯Ø¦Ø©
                </h2>

                <div class="games-grid">
                    <!-- Breathing Game -->
                    <div class="game-card" onclick="startGame('breathing')">
                        <div class="game-icon">
                            <i class="fas fa-cloud-moon"></i>
                        </div>
                        <div class="game-title game-title-en">Deep Breathing Game</div>
                        <div class="game-title game-title-ar" style="display: none;">Ù„Ø¹Ø¨Ø© Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ‚</div>
                        <p class="game-desc game-desc-en">
                            Interactive breathing exercises to reduce anxiety and improve focus.
                        </p>
                        <p class="game-desc game-desc-ar" style="display: none;">
                            ØªÙ…Ø§Ø±ÙŠÙ† ØªÙ†ÙØ³ ØªÙØ§Ø¹Ù„ÙŠØ© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‚Ù„Ù‚ ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ±ÙƒÙŠØ².
                        </p>
                    </div>

                    <!-- Puzzle Game -->
                    <div class="game-card" onclick="startGame('puzzle')">
                        <div class="game-icon">
                            <i class="fas fa-puzzle-piece"></i>
                        </div>
                        <div class="game-title game-title-en">Calming Puzzle</div>
                        <div class="game-title game-title-ar" style="display: none;">Ù„ØºØ² Ù…Ù‡Ø¯Ø¦</div>
                        <p class="game-desc game-desc-en">
                            Solve puzzles with peaceful images to enhance relaxation and cognitive skills.
                        </p>
                        <p class="game-desc game-desc-ar" style="display: none;">
                            Ø­Ù„ Ø£Ù„ØºØ§Ø² Ø¨ØµÙˆØ± Ù‡Ø§Ø¯Ø¦Ø© Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙÙŠØ©.
                        </p>
                    </div>

                    <!-- Color Game -->
                    <div class="game-card" onclick="startGame('color')">
                        <div class="game-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <div class="game-title game-title-en">Color Harmony</div>
                        <div class="game-title game-title-ar" style="display: none;">ØªÙ†Ø§ØºÙ… Ø§Ù„Ø£Ù„ÙˆØ§Ù†</div>
                        <p class="game-desc game-desc-en">
                            Discover calming colors and create beautiful color palettes for relaxation.
                        </p>
                        <p class="game-desc game-desc-ar" style="display: none;">
                            Ø§ÙƒØªØ´Ù Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ø¯Ø¦Ø© ÙˆØ£Ù†Ø´Ø¦ Ù„ÙˆØ­Ø§Øª Ø£Ù„ÙˆØ§Ù† Ø¬Ù…ÙŠÙ„Ø© Ù„Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡.
                        </p>
                    </div>

                    <!-- Sound Game -->
                    <div class="game-card" onclick="startGame('sound')">
                        <div class="game-icon">
                            <i class="fas fa-headphones"></i>
                        </div>
                        <div class="game-title game-title-en">Sound Focus</div>
                        <div class="game-title game-title-ar" style="display: none;">ØªØ±ÙƒÙŠØ² Ø§Ù„ØµÙˆØª</div>
                        <p class="game-desc game-desc-en">
                            Improve concentration by matching sounds and sequences for better focus.
                        </p>
                        <p class="game-desc game-desc-ar" style="display: none;">
                            Ø­Ø³Ù† ØªØ±ÙƒÙŠØ²Ùƒ Ø¨Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£ØµÙˆØ§Øª ÙˆØ§Ù„ØªØ³Ù„Ø³Ù„Ø§Øª Ù„ØªØ±ÙƒÙŠØ² Ø£ÙØ¶Ù„.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile-section" class="content-section">
                <div class="profile-container">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar" id="profile-avatar">U</div>
                            <div class="profile-info">
                                <h2 id="profile-name">Loading...</h2>
                                <div class="profile-subscription free" id="profile-subscription">Free Plan</div>
                                <p style="color: #666; margin-top: 0.5rem;" id="profile-email">Loading...</p>
                            </div>
                        </div>

                        <div class="profile-stats">
                            <div class="profile-stat">
                                <div class="profile-stat-value" id="profile-days-active">0</div>
                                <div class="profile-stat-label profile-stat-label-en">Days Active</div>
                                <div class="profile-stat-label profile-stat-label-ar" style="display: none;">Ø£ÙŠØ§Ù… Ø§Ù„Ù†Ø´Ø§Ø·</div>
                            </div>
                            <div class="profile-stat">
                                <div class="profile-stat-value" id="profile-messages-sent">0</div>
                                <div class="profile-stat-label profile-stat-label-en">Messages Sent</div>
                                <div class="profile-stat-label profile-stat-label-ar" style="display: none;">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©</div>
                            </div>
                            <div class="profile-stat">
                                <div class="profile-stat-value" id="profile-sessions">0</div>
                                <div class="profile-stat-label profile-stat-label-en">Meditation Sessions</div>
                                <div class="profile-stat-label profile-stat-label-ar" style="display: none;">Ø¬Ù„Ø³Ø§Øª Ø§Ù„ØªØ£Ù…Ù„</div>
                            </div>
                            <div class="profile-stat">
                                <div class="profile-stat-value" id="profile-streak">0</div>
                                <div class="profile-stat-label profile-stat-label-en">Day Streak</div>
                                <div class="profile-stat-label profile-stat-label-ar" style="display: none;">ØªÙˆØ§ØµÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</div>
                            </div>
                        </div>

                        <h3 style="margin-bottom: 1rem; color: var(--primary-color);">
                            <i class="fas fa-cog"></i> 
                            <span class="settings-title-en">Account Settings</span>
                            <span class="settings-title-ar" style="display: none;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</span>
                        </h3>

                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                            <button class="btn-primary" onclick="openSubscriptionModal()" style="flex: 1; padding: 0.8rem; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-crown"></i>
                                <span class="btn-text-en">Upgrade Plan</span>
                                <span class="btn-text-ar" style="display: none;">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø®Ø·Ø©</span>
                            </button>
                            <button class="btn-secondary" onclick="openSettingsModal()" style="flex: 1; padding: 0.8rem; background: var(--light-color); color: var(--dark-color); border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-sliders-h"></i>
                                <span class="btn-text-en">Settings</span>
                                <span class="btn-text-ar" style="display: none;">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                            </button>
                            <button class="btn-danger" onclick="logout()" style="flex: 1; padding: 0.8rem; background: var(--error-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-sign-out-alt"></i>
                                <span class="btn-text-en">Logout</span>
                                <span class="btn-text-ar" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                            </button>
                        </div>

                        <div class="privacy-notice" style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <i class="fas fa-shield-alt" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                            <span class="privacy-text-en" style="font-size: 0.9rem;">
                                Your data is securely encrypted. Read our 
                                <a href="#" style="color: var(--primary-color); text-decoration: none;">Privacy Policy</a> 
                                for more information.
                            </span>
                            <span class="privacy-text-ar" style="font-size: 0.9rem; display: none;">
                                Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø´ÙØ±Ø© Ø¨Ø£Ù…Ø§Ù†. Ø§Ù‚Ø±Ø£ 
                                <a href="#" style="color: var(--primary-color); text-decoration: none;">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a> 
                                Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.
                            </span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Subscription Modal -->
    <div class="modal" id="subscription-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title modal-title-en">
                    <i class="fas fa-crown"></i> Upgrade Your Plan
                </h3>
                <h3 class="modal-title modal-title-ar" style="display: none;">
                    <i class="fas fa-crown"></i> ØªØ±Ù‚ÙŠØ© Ø®Ø·ØªÙƒ
                </h3>
                <button class="modal-close" onclick="closeSubscriptionModal()">&times;</button>
            </div>
            <div id="subscription-plans">
                <!-- Plans will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title modal-title-en">
                    <i class="fas fa-cog"></i> Account Settings
                </h3>
                <h3 class="modal-title modal-title-ar" style="display: none;">
                    <i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
                </h3>
                <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
            </div>
            <div id="settings-content">
                <!-- Settings will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Current language and user data
        let currentLang = 'en';
        let userToken = '';
        let currentUser = null;
        let isAuthenticated = false;
        let chatSessionId = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            checkUserAuth();

            // Initialize language
            initializeLanguage('en');

            // Setup language switcher
            document.getElementById('arabic-btn').addEventListener('click', function() {
                switchLanguage('ar');
            });

            document.getElementById('english-btn').addEventListener('click', function() {
                switchLanguage('en');
            });

            // Setup sidebar menu
            document.querySelectorAll('.menu-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('.menu-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    // Add active class to clicked button
                    this.classList.add('active');

                    // Hide all sections
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });

                    // Show selected section
                    const sectionId = this.getAttribute('data-section');
                    const targetId = sectionId === 'content' ? 'content-section-relax' : 
                                   sectionId === 'games' ? 'games-section' : 
                                   `${sectionId}-section`;
                    document.getElementById(targetId).classList.add('active');

                    // Load data for the section if needed
                    if (isAuthenticated) {
                        loadSectionData(sectionId);
                    }
                });
            });

            // Setup quick action buttons
            setupQuickActions();

            // Setup chat
            setupChat();

            // Setup user profile dropdown
            setupUserProfile();

            // Load initial data
            if (isAuthenticated) {
                loadDashboardData();
                loadUserProfile();
            }
        });

        // Check user authentication
        async function checkUserAuth() {
            const token = localStorage.getItem('userToken');
            if (!token) {
                // Redirect to login if no token
                window.location.href = '/login.html';
                return;
            }

            try {
                const response = await fetch('/api/auth/verify-token', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    userToken = token;
                    isAuthenticated = true;
                    await loadUserData();
                } else {
                    localStorage.removeItem('userToken');
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('Auth check error:', error);
                localStorage.removeItem('userToken');
                window.location.href = '/login.html';
            }
        }

        // Load user data
        async function loadUserData() {
            try {
                const response = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    currentUser = await response.json();
                    updateUserUI(currentUser);
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Update user UI
        function updateUserUI(user) {
            // Update header
            document.getElementById('user-name').textContent = user.first_name ? 
                `${user.first_name} ${user.last_name || ''}` : user.username;
            document.getElementById('user-subscription').textContent = 
                user.subscription_type === 'premium' ? 'Premium Plan' : 
                user.subscription_type === 'pro' ? 'Pro Plan' : 'Free Plan';
            
            // Update avatar
            const avatar = document.getElementById('user-avatar');
            if (user.first_name) {
                avatar.textContent = user.first_name[0].toUpperCase();
            }
            
            // Update greeting
            document.getElementById('user-greeting-name').textContent = user.first_name || user.username;
            document.getElementById('user-greeting-name-ar').textContent = user.first_name || user.username;

            // Update profile section
            document.getElementById('profile-name').textContent = user.first_name ? 
                `${user.first_name} ${user.last_name || ''}` : user.username;
            document.getElementById('profile-email').textContent = user.email;
            
            const profileSubscription = document.getElementById('profile-subscription');
            profileSubscription.textContent = user.subscription_type === 'premium' ? 'Premium Plan' : 
                                            user.subscription_type === 'pro' ? 'Pro Plan' : 'Free Plan';
            profileSubscription.className = `profile-subscription ${user.subscription_type}`;
            
            const profileAvatar = document.getElementById('profile-avatar');
            if (user.first_name) {
                profileAvatar.textContent = user.first_name[0].toUpperCase();
            }
        }

        // Initialize language
        function initializeLanguage(lang) {
            currentLang = lang;
            updateLanguageButtons(lang);
            updateAllText(lang);
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = lang;
        }

        // Switch language
        function switchLanguage(lang) {
            currentLang = lang;
            updateLanguageButtons(lang);
            updateAllText(lang);
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = lang;
        }

        // Update language buttons
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            if (lang === 'en') {
                document.getElementById('english-btn').classList.add('active');
            } else {
                document.getElementById('arabic-btn').classList.add('active');
            }
        }

        // Update all text in the page
        function updateAllText(lang) {
            // List of all language-specific classes
            const langElements = [
                'site-title', 'site-subtitle', 'lang-text', 'menu-text',
                'greeting', 'welcome-message', 'section-subtitle', 'stat-title',
                'action-title', 'action-desc', 'chat-title', 'chat-subtitle',
                'chat-stat', 'send-text', 'privacy-text', 'content-title',
                'content-desc', 'game-title', 'game-desc', 'profile-stat-label',
                'settings-title', 'btn-text', 'modal-title'
            ];

            // Update all standard language elements
            langElements.forEach(className => {
                // Hide both languages
                document.querySelectorAll(`.${className}-en, .${className}-ar`).forEach(el => {
                    el.style.display = 'none';
                });

                // Show current language
                document.querySelectorAll(`.${className}-${lang}`).forEach(el => {
                    el.style.display = 'block';
                });
            });

            // Update input placeholders
            const messageInput = document.getElementById('message-input');
            if (messageInput) {
                messageInput.placeholder = lang === 'ar' ? 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...' : 'Type your message here...';
            }
        }

        // Load section data
        async function loadSectionData(sectionId) {
            if (!isAuthenticated) return;

            switch(sectionId) {
                case 'dashboard':
                    await loadDashboardData();
                    break;
                case 'chat':
                    await loadChatHistory();
                    break;
                case 'profile':
                    await loadProfileStats();
                    break;
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load stats
                const statsResponse = await fetch('/api/user/stats', {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    updateDashboardStats(stats);
                }

                // Load recent activity
                await loadRecentActivity();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Update dashboard stats
        function updateDashboardStats(stats) {
            if (stats.total_conversations !== undefined) {
                document.getElementById('total-conversations').textContent = stats.total_conversations;
            }
            if (stats.mindfulness_minutes !== undefined) {
                document.getElementById('mindfulness-minutes').textContent = stats.mindfulness_minutes;
            }
            if (stats.mood_score !== undefined) {
                document.getElementById('mood-score').textContent = `${stats.mood_score}/10`;
            }
            if (stats.achievements_count !== undefined) {
                document.getElementById('achievements-count').textContent = stats.achievements_count;
            }
            if (stats.messages_left !== undefined) {
                document.getElementById('messages-left').textContent = stats.messages_left;
            }
            if (stats.login_streak !== undefined) {
                document.getElementById('login-streak').textContent = `${stats.login_streak} days`;
            }
        }

        // Load recent activity
        async function loadRecentActivity() {
            try {
                const response = await fetch('/api/user/activity', {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    const activities = await response.json();
                    updateRecentActivity(activities);
                }
            } catch (error) {
                console.error('Error loading recent activity:', error);
            }
        }

        // Update recent activity
        function updateRecentActivity(activities) {
            const container = document.getElementById('recent-activity');
            if (!container) return;

            if (!activities || activities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 1rem;">
                        ${currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø­Ø¯ÙŠØ«Ø©' : 'No recent activity'}
                    </div>
                `;
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 0.8rem;">';
            
            activities.forEach(activity => {
                let activityText = activity.type || 'Unknown activity';
                let icon = 'fas fa-circle';
                let time = new Date(activity.timestamp).toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                if (currentLang === 'ar') {
                    // Translate activity types to Arabic
                    const translations = {
                        'chat': 'Ù…Ø­Ø§Ø¯Ø«Ø©',
                        'meditation': 'ØªØ£Ù…Ù„',
                        'breathing': 'ØªÙ…Ø±ÙŠÙ† ØªÙ†ÙØ³',
                        'game': 'Ù„Ø¹Ø¨Ø©',
                        'mood_check': 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø²Ø§Ø¬'
                    };
                    activityText = translations[activity.type] || activityText;
                }

                html += `
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 0.5rem; background: #f8f9fa; border-radius: 8px;">
                        <i class="${icon}" style="color: var(--primary-color); font-size: 0.8rem;"></i>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">${activityText}</div>
                            <div style="font-size: 0.8rem; color: #666;">${time}</div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // Setup quick actions
        function setupQuickActions() {
            // Quick chat button
            document.getElementById('quick-chat-btn').addEventListener('click', function() {
                // Switch to chat section
                document.querySelectorAll('.menu-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.menu-btn[data-section="chat"]').classList.add('active');
                
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById('chat-section').classList.add('active');
                
                // Focus on chat input
                setTimeout(() => {
                    document.getElementById('message-input').focus();
                }, 100);
            });

            // Breathing exercise button
            document.getElementById('breathing-exercise-btn').addEventListener('click', function() {
                startBreathingExercise();
            });

            // Mood check button
            document.getElementById('mood-check-btn').addEventListener('click', function() {
                checkMood();
            });

            // Journal button
            document.getElementById('journal-btn').addEventListener('click', function() {
                openJournal();
            });
        }

        // Setup chat
        function setupChat() {
            const sendButton = document.getElementById('send-btn');
            const messageInput = document.getElementById('message-input');

            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();

            if (message === '') return;

            // Add user message to chat
            addMessageToChat(message, 'user');

            // Clear input
            input.value = '';

            // Scroll to bottom
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Send to AI
            try {
                const response = await fetch('/api/ai/chat', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${userToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        session_id: chatSessionId
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    // Save session ID if new session
                    if (data.session_id && !chatSessionId) {
                        chatSessionId = data.session_id;
                    }

                    // Add AI response to chat
                    if (data.response) {
                        // Decrypt if needed (in real app)
                        addMessageToChat(data.response, 'ai');
                    }
                } else {
                    throw new Error('Failed to get response');
                }
            } catch (error) {
                console.error('Error sending message:', error);
                addMessageToChat(
                    currentLang === 'ar' ? 
                    'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.' :
                    "I'm sorry, something went wrong. Please try again.",
                    'ai'
                );
            }
        }

        // Add message to chat
        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = message;
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Load chat history
        async function loadChatHistory() {
            try {
                const response = await fetch('/api/ai/chat-sessions', {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    const sessions = await response.json();
                    if (sessions.length > 0) {
                        // Load last session
                        const lastSession = sessions[0];
                        chatSessionId = lastSession.id;
                        await loadSessionMessages(lastSession.id);
                    } else {
                        // Start new session
                        addWelcomeMessage();
                    }
                }
            } catch (error) {
                console.error('Error loading chat history:', error);
                addWelcomeMessage();
            }
        }

        // Load session messages
        async function loadSessionMessages(sessionId) {
            try {
                const response = await fetch(`/api/ai/chat-sessions/${sessionId}`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    const session = await response.json();
                    const chatMessages = document.getElementById('chat-messages');
                    chatMessages.innerHTML = '';

                    if (session.messages && session.messages.length > 0) {
                        session.messages.forEach(msg => {
                            addMessageToChat(msg.content, msg.role === 'user' ? 'user' : 'ai');
                        });
                    } else {
                        addWelcomeMessage();
                    }
                }
            } catch (error) {
                console.error('Error loading session messages:', error);
                addWelcomeMessage();
            }
        }

        // Add welcome message
        function addWelcomeMessage() {
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            
            const welcomeMessage = currentLang === 'ar' ? 
                'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ CalmAI. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ' :
                "Hello! I'm your CalmAI assistant. How can I help you today?";
            
            addMessageToChat(welcomeMessage, 'ai');
        }

        // Setup user profile
        function setupUserProfile() {
            document.getElementById('user-profile-btn').addEventListener('click', function() {
                // Switch to profile section
                document.querySelectorAll('.menu-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.menu-btn[data-section="profile"]').classList.add('active');
                
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById('profile-section').classList.add('active');
            });
        }

        // Load user profile
        async function loadUserProfile() {
            try {
                const response = await fetch('/api/user/profile', {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    const profile = await response.json();
                    updateProfileStats(profile);
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        // Load profile stats
        async function loadProfileStats() {
            try {
                const response = await fetch('/api/user/stats/detailed', {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    updateProfileStats(stats);
                }
            } catch (error) {
                console.error('Error loading profile stats:', error);
            }
        }

        // Update profile stats
        function updateProfileStats(stats) {
            if (stats.days_active !== undefined) {
                document.getElementById('profile-days-active').textContent = stats.days_active;
            }
            if (stats.messages_sent !== undefined) {
                document.getElementById('profile-messages-sent').textContent = stats.messages_sent;
            }
            if (stats.meditation_sessions !== undefined) {
                document.getElementById('profile-sessions').textContent = stats.meditation_sessions;
            }
            if (stats.login_streak !== undefined) {
                document.getElementById('profile-streak').textContent = stats.login_streak;
            }
        }

        // Start breathing exercise
        function startBreathingExercise() {
            showToast(
                currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙØ³...' : 'Starting breathing exercise...',
                'info'
            );
            
            // In a real app, you would open the breathing exercise module
            setTimeout(() => {
                showToast(
                    currentLang === 'ar' ? 'ØªÙ… Ø¨Ø¯Ø¡ ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙØ³' : 'Breathing exercise started',
                    'success'
                );
            }, 1000);
        }

        // Start meditation
        function startMeditation() {
            showToast(
                currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„ØªØ£Ù…Ù„...' : 'Starting meditation session...',
                'info'
            );
        }

        // Play sleep story
        function playSleepStory() {
            showToast(
                currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ù‚ØµØ© Ø§Ù„Ù†ÙˆÙ…...' : 'Playing sleep story...',
                'info'
            );
        }

        // Start game
        function startGame(gameType) {
            showToast(
                currentLang === 'ar' ? `Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© ${gameType}...` : `Starting ${gameType} game...`,
                'info'
            );
        }

        // Check mood
        function checkMood() {
            const moodOptions = currentLang === 'ar' ? 
                ['ğŸ˜Š Ø³Ø¹ÙŠØ¯', 'ğŸ˜ Ù…Ø­Ø§ÙŠØ¯', 'ğŸ˜” Ø­Ø²ÙŠÙ†', 'ğŸ˜° Ù‚Ù„Ù‚', 'ğŸ˜´ Ù…ØªØ¹Ø¨'] :
                ['ğŸ˜Š Happy', 'ğŸ˜ Neutral', 'ğŸ˜” Sad', 'ğŸ˜° Anxious', 'ğŸ˜´ Tired'];
            
            let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';
            html += `<p>${currentLang === 'ar' ? 'ÙƒÙŠÙ ØªØ´Ø¹Ø± Ø§Ù„Ø¢Ù†ØŸ' : 'How are you feeling right now?'}</p>`;
            
            moodOptions.forEach(option => {
                html += `
                    <button onclick="submitMood('${option.split(' ')[0]}')" 
                            style="padding: 1rem; border: 2px solid #e1e8f0; border-radius: 8px; background: white; cursor: pointer; text-align: left; font-size: 1.1rem;">
                        ${option}
                    </button>
                `;
            });
            
            html += '</div>';
            
            // Show mood modal (simplified version)
            showToast(
                currentLang === 'ar' ? 'Ø§Ø®ØªØ± Ù…Ø²Ø§Ø¬Ùƒ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©' : 'Select your mood from the list',
                'info'
            );
        }

        // Submit mood
        async function submitMood(mood) {
            try {
                const response = await fetch('/api/user/mood', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${userToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ mood })
                });

                if (response.ok) {
                    showToast(
                        currentLang === 'ar' ? 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø²Ø§Ø¬Ùƒ!' : 'Thank you for sharing your mood!',
                        'success'
                    );
                    
                    // Update today's mood
                    document.getElementById('today-mood').textContent = 
                        mood === 'ğŸ˜Š' ? 'Good' : 
                        mood === 'ğŸ˜' ? 'Neutral' : 
                        mood === 'ğŸ˜”' ? 'Sad' : 
                        mood === 'ğŸ˜°' ? 'Anxious' : 'Tired';
                }
            } catch (error) {
                console.error('Error submitting mood:', error);
            }
        }

        // Open journal
        function openJournal() {
            showToast(
                currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª...' : 'Opening journal...',
                'info'
            );
        }

        // Open subscription modal
        async function openSubscriptionModal() {
            try {
                const response = await fetch('/api/payment/plans', {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    const plans = await response.json();
                    displaySubscriptionPlans(plans);
                    document.getElementById('subscription-modal').classList.add('active');
                }
            } catch (error) {
                console.error('Error loading subscription plans:', error);
                showToast(
                    currentLang === 'ar' ? 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·Ø·' : 'Failed to load plans',
                    'error'
                );
            }
        }

        // Display subscription plans
        function displaySubscriptionPlans(plans) {
            const container = document.getElementById('subscription-plans');
            if (!container) return;

            let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';
            
            plans.forEach(plan => {
                html += `
                    <div style="border: 2px solid ${plan.color}; border-radius: 12px; padding: 1.5rem; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4 style="margin: 0; color: ${plan.color};">
                                ${currentLang === 'ar' ? plan.name_ar : plan.name_en}
                            </h4>
                            <div style="font-size: 1.5rem; font-weight: bold; color: ${plan.color};">
                                $${plan.price}/month
                            </div>
                        </div>
                        <ul style="padding-left: 1.2rem; margin-bottom: 1.5rem;">
                `;
                
                plan.features.forEach(feature => {
                    html += `
                        <li style="margin-bottom: 0.5rem;">
                            ${currentLang === 'ar' ? feature.ar : feature.en}
                        </li>
                    `;
                });
                
                html += `
                        </ul>
                        <button onclick="subscribeToPlan('${plan.id}')" 
                                style="width: 100%; padding: 0.8rem; background: ${plan.color}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ${currentLang === 'ar' ? 'Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†' : 'Subscribe Now'}
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Subscribe to plan
        async function subscribeToPlan(planId) {
            try {
                const response = await fetch('/api/payment/create-subscription', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${userToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ plan: planId })
                });

                if (response.ok) {
                    showToast(
                        currentLang === 'ar' ? 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­!' : 'Subscription created successfully!',
                        'success'
                    );
                    closeSubscriptionModal();
                    
                    // Reload user data to update subscription status
                    await loadUserData();
                } else {
                    throw new Error('Failed to create subscription');
                }
            } catch (error) {
                console.error('Error subscribing to plan:', error);
                showToast(
                    currentLang === 'ar' ? 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ' : 'Failed to create subscription',
                    'error'
                );
            }
        }

        // Close subscription modal
        function closeSubscriptionModal() {
            document.getElementById('subscription-modal').classList.remove('active');
        }

        // Open settings modal
        function openSettingsModal() {
            // Load settings
            const settingsContent = document.getElementById('settings-content');
            settingsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <div>
                        <h4 style="margin-bottom: 1rem; color: var(--primary-color);">
                            ${currentLang === 'ar' ? 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª' : 'Notification Settings'}
                        </h4>
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.8rem;">
                            <input type="checkbox" checked>
                            <span>${currentLang === 'ar' ? 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©' : 'Chat notifications'}</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.8rem;">
                            <input type="checkbox" checked>
                            <span>${currentLang === 'ar' ? 'ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„ØªØ£Ù…Ù„' : 'Meditation reminders'}</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox">
                            <span>${currentLang === 'ar' ? 'Ø±Ø³Ø§Ø¦Ù„ ØªØ±ÙˆÙŠØ¬ÙŠØ©' : 'Promotional messages'}</span>
                        </label>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 1rem; color: var(--primary-color);">
                            ${currentLang === 'ar' ? 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©' : 'Privacy Settings'}
                        </h4>
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.8rem;">
                            <input type="checkbox" checked>
                            <span>${currentLang === 'ar' ? 'Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„Ø©' : 'Share anonymous data'}</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" checked>
                            <span>${currentLang === 'ar' ? 'ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹' : 'Store conversations locally'}</span>
                        </label>
                    </div>
                    
                    <button onclick="saveSettings()" style="padding: 0.8rem; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                        ${currentLang === 'ar' ? 'Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' : 'Save Settings'}
                    </button>
                </div>
            `;
            
            document.getElementById('settings-modal').classList.add('active');
        }

        // Save settings
        async function saveSettings() {
            showToast(
                currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...' : 'Saving settings...',
                'info'
            );
            
            setTimeout(() => {
                showToast(
                    currentLang === 'ar' ? 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' : 'Settings saved',
                    'success'
                );
                closeSettingsModal();
            }, 1000);
        }

        // Close settings modal
        function closeSettingsModal() {
            document.getElementById('settings-modal').classList.remove('active');
        }

        // Logout
        function logout() {
            if (confirm(currentLang === 'ar' ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ' : 'Are you sure you want to logout?')) {
                localStorage.removeItem('userToken');
                showToast(
                    currentLang === 'ar' ? 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­' : 'Logged out successfully',
                    'success'
                );
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 1000);
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) return;

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.setAttribute('aria-live', 'polite');

            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';

            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <div class="toast-content">${message}</div>
                <button class="toast-close" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            `;

            toastContainer.appendChild(toast);

            // Setup close button
            const closeBtn = toast.querySelector('.toast-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                });
            }

            // Remove toast after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
        }

        // Make functions available globally
        window.startMeditation = startMeditation;
        window.startBreathingExercise = startBreathingExercise;
        window.playSleepStory = playSleepStory;
        window.startGame = startGame;
        window.checkMood = checkMood;
        window.submitMood = submitMood;
        window.openJournal = openJournal;
        window.openSubscriptionModal = openSubscriptionModal;
        window.closeSubscriptionModal = closeSubscriptionModal;
        window.openSettingsModal = openSettingsModal;
        window.closeSettingsModal = closeSettingsModal;
        window.saveSettings = saveSettings;
        window.subscribeToPlan = subscribeToPlan;
        window.logout = logout;
    </script>
</body>
</html>
